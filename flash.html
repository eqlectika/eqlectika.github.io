<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Text converter for fast reading</title>
  <style>
    html, body {
      overscroll-behavior: none;
      height: 100vh;
      margin: 0;
      padding: 0;
      background-color: #000000;
      color: #fff;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      -webkit-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
      -webkit-tap-highlight-color: transparent;
      touch-action: none;
    }

    /* Группы элементов, которые будут затеняться */
    #inputContainer, #colorControl, .footer-block {
      transition: opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1);
      opacity: 1; /* По умолчанию всё ярко */
    }

    /* Состояние глубокого погружения в чтение */
    body.is-reading #inputContainer,
    body.is-reading #colorControl,
    body.is-reading .footer-block {
      opacity: 0;
      pointer-events: none; /* Чтобы случайно не нажать в темноте */
    }

    #inputContainer { padding: 20px 15px; text-align: center; flex-shrink: 0; }
    
    #inputText {
      width: 90%; max-width: 600px; padding: 12px; font-size: 16px;
      background: #111; color: #fff; border: 1px solid #444; border-radius: 5px;
      outline: none; -webkit-user-select: text; user-select: text; touch-action: pan-y;
    }

    #colorControl {
      color: #fff; /* Теперь в полном цвете по умолчанию */
      border: 1px solid rgba(255, 255, 255, 0.6);
      border-radius: 12px; padding: 10px 20px; font-size: 14px;
      cursor: pointer; margin: 20px auto; display: block; width: fit-content;
    }

    #container {
      flex-grow: 1; display: flex; justify-content: center; align-items: center;
      position: relative; margin: 40px 0;
    }

    .word-layer {
      position: absolute; text-align: center; font-weight: bold;
      white-space: nowrap; transition: opacity 0.18s ease-out, transform 0.18s ease-out;
      will-change: transform, opacity;
    }

    .word-enter { opacity: 0; transform: scale(1.1); }
    .word-active { opacity: 1; transform: scale(1); }
    .word-exit { opacity: 0; transform: scale(0.9); }

    .footer-block { flex-shrink: 0; padding-bottom: env(safe-area-inset-bottom, 20px); text-align: center; }
    .logo-container { margin-bottom: 30px; }
    .logo-image { opacity: 0.8; max-width: 48px; }

    #buttonsContainer { padding: 8px; margin-bottom: 30px; }
    button {
      font-size: 16px; background-color: transparent; color: white;
      border-radius: 10px; border: 1px solid #fff; padding: 8px 13px;
      margin: 0 5px; cursor: pointer; min-width: 62px; touch-action: manipulation;
    }
  </style>
</head>
<body oncontextmenu="return false;">

  <div id="inputContainer">
    <input type="text" id="inputText" value="Paste your text into this field (top) and tap 'Start' (bottom) to begin reading. Tap the screen to return to the interface and adjust the speed. Add spaces where you feel pauses are necessary before recording your message." />
  </div>

  <div id="colorControl">Background Color</div>
  
  <div id="container"></div>
  
  <div class="footer-block">
    <div class="logo-container">
      <a href="index.html" style="-webkit-user-drag: none;">
        <img src="logo.png" alt="Logo" class="logo-image">
      </a>
    </div>
    <div id="buttonsContainer">
      <button id="fasterBtn">Faster</button>
      <button id="startBtn">Start</button>
      <button id="slowerBtn">Slower</button>
    </div>
  </div>

  <script>
    const container = document.getElementById('container');
    const inputText = document.getElementById('inputText');
    const startBtn = document.getElementById('startBtn');
    const fasterBtn = document.getElementById('fasterBtn');
    const slowerBtn = document.getElementById('slowerBtn');
    const colorControl = document.getElementById('colorControl');

    const colors = ['#000000', '#450a0a', '#0a0a45', '#0a450a', '#222222'];
    let colorIndex = 0;
    let words = [];
    let index = 0;
    let interval = 75; 
    let timer = null;

    function toggleUI(show) {
      if (show) document.body.classList.remove('is-reading');
      else document.body.classList.add('is-reading');
    }

    // Возвращаем интерфейс при любом касании экрана
    document.body.addEventListener('touchstart', () => {
      if (document.body.classList.contains('is-reading')) {
        toggleUI(true);
        clearTimeout(timer); // Остановка чтения при возврате UI — опционально
      }
    }, { passive: false });

    colorControl.onclick = (e) => {
      e.stopPropagation();
      colorIndex = (colorIndex + 1) % colors.length;
      document.body.style.backgroundColor = colors[colorIndex];
    };

    function getFontSize(word) {
      const baseSize = window.innerWidth / 9;
      return word.length > 15 ? baseSize / 1.6 : baseSize;
    }

    function showNext() {
      if (index >= words.length) { 
        index = 0;
        toggleUI(true);
        return; 
      }

      const txt = words[index];
      const newEl = document.createElement('div');
      newEl.className = 'word-layer word-enter';
      newEl.textContent = txt === " " ? "" : txt;
      newEl.style.fontSize = getFontSize(txt) + 'px';
      
      const oldEl = container.querySelector('.word-active');
      if (oldEl) {
        oldEl.classList.replace('word-active', 'word-exit');
        setTimeout(() => oldEl.remove(), 180);
      }

      container.appendChild(newEl);
      newEl.offsetHeight;
      newEl.classList.replace('word-enter', 'word-active');

      let delay = interval + (txt.length * 8);
      if (/[.,—:;!?]/.test(txt)) delay *= 2.5;
      if (txt === " ") delay *= 4.5;

      index++;
      timer = setTimeout(showNext, delay);
    }

    startBtn.onclick = (e) => {
      e.stopPropagation();
      words = inputText.value.trim().split(/(\s{2,})|\s+/).filter(Boolean).map(w => w.trim() === "" ? " " : w);
      index = 0;
      container.innerHTML = '';
      toggleUI(false); // Прячем всё
      setTimeout(showNext, 500); // Небольшая задержка для красоты ухода UI
    };

    fasterBtn.onclick = (e) => { e.stopPropagation(); interval = Math.max(5, interval - 10); };
    slowerBtn.onclick = (e) => { e.stopPropagation(); interval += 10; };

    document.addEventListener('touchstart', (e) => {
      if (!['INPUT', 'BUTTON'].includes(e.target.tagName)) {
        if (e.touches.length > 1) e.preventDefault();
      }
    }, { passive: false });
  </script>
</body>
</html>
