<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Vital Spark</title>
  <link rel="manifest" href="manifestspark.json">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --main-font: monospace;
      --bg-color: #000;
      --time-color: #8493d6;
      --breath-color: #ffffff;
      --pulse-color: #ff1493;
      --emotion-color: #ff5252;
      --energy-color: #ff9800;
      --focus-color: #ffeb3b;
      --creativity-color: #00ff00;
      --vision-color: #0000ff;
      --hearing-color: #9c27b0;
      --smell-color: #00bcd4;
      --dopamine-color: #ff00ff;
      --load-color: #adff2f;
      --tension-color: #cccccc;
      --light-gray: #aaaaaa;
      --vesting-color: #ff0000;
      --hype-color: #00ffff;
      --squeeze-color: #ffff00;
      --supply-color: #ffa500;
      --audit-color: #7cfc00;

    }

    body {
      background: var(--bg-color);
      color: #fff;
      font-family: var(--main-font);
      padding: 20px;
      margin: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
                       /* защита от выделения и системных меню */
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;

    -webkit-touch-callout: none;
    -webkit-tap-highlight-color: transparent;
    }

    h2 { margin-top: 0; }
    
.header-container {
  display: flex;
  flex-direction: column; /* Выстраиваем элементы в колонку */
  align-items: flex-start; /* Выравниваем по левому краю */
  gap: 10px; /* Управляем отступом между лого и текстом здесь */
  margin-bottom: 20px;
}

/* Опционально: если хотите, чтобы логотип был чуть меньше в шапке */
.header-container .logo-image {
  max-width: 48px; 
  opacity: 0.9;
}

    .protocol-details {
      cursor: pointer;
      margin-bottom: 25px;
      font-size: 13px;
      color: #666;
    }

    .protocol-content {
      border-left: 1px solid #333;
      padding: 10px 0 10px 15px;
      margin-top: 10px;
      line-height: 1.6;
      color: #aaa;
    }

    .select-container {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 30px;
    }

    .select-group {
      flex: 1 1 180px;
      display: flex;
      flex-direction: column;
    }

    .select-group label {
      margin-bottom: 8px;
      font-weight: bold;
      font-size: 14px;
    }

    select {
      appearance: none;
      -webkit-appearance: none;
      background: #000;
      color: #fff;
      border: 1px solid var(--light-gray);
      padding: 12px;
      font-family: var(--main-font);
      font-size: 14px;
      cursor: pointer;
    }

    #time { border-color: var(--time-color); }
    #breath { border-color: var(--breath-color); }
    #pulse { border-color: var(--pulse-color); }
    #emotion { border-color: var(--emotion-color); }
    #dopamine { border-color: var(--dopamine-color); }
    #load { border-color: var(--load-color); }
    #tension { border-color: var(--tension-color); }
    #energy { border-color: var(--energy-color); }
    #focus { border-color: var(--focus-color); }
    #creativity { border-color: var(--creativity-color); }
    #vision { border-color: var(--vision-color); }
    #hearing { border-color: var(--hearing-color); }
    #smell { border-color: var(--smell-color); }
    #vesting { border-color: var(--vesting-color); }
    #hype { border-color: var(--hype-color); }
    #squeeze { border-color: var(--squeeze-color); }
    #supply { border-color: var(--supply-color); }
    #audit { border-color: var(--audit-color); }

    .chart-container {
      position: relative;
      height: 50vh;
      width: 100%;
      margin-top: 20px;
    }

    .buttons {
      margin-top: 20px;
      display: flex;
      gap: 10px;
    }

    button.ui-btn {
      background: #111;
      color: var(--light-gray);
      border: 1px solid #444;
      padding: 8px 12px;
      font-family: var(--main-font);
      cursor: pointer;
      font-size: 11px;
    }

    footer {
      margin-top: auto;
      padding-top: 40px;
      padding-bottom: 20px;
      display: flex;
      align-items: flex-start;
    }

    .footer-left {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 25px;
    }

    .logo-image {
      opacity: 0.9;
      max-width: 48px;
      transition: opacity 0.3s;
      display: block;
    }

    .logo-image:hover { opacity: 0.8; }

    .donate-box {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .donate-btn {
      color: var(--light-gray);
      text-decoration: none;
      font-size: 12px;
      border: 1px solid var(--light-gray);
      padding: 5px 15px;
      transition: all 0.3s;
      background: transparent;
      cursor: pointer;
      font-family: var(--main-font);
      display: inline-block;
      width: fit-content;
    }

    .donate-btn:hover {
      background: var(--light-gray);
      color: #000;
    }

    .crypto-info {
      display: none;
      flex-direction: column;
      gap: 5px;
    }

    .network-label {
      font-size: 10px;
      color: var(--light-gray);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .crypto-address-display {
      font-size: 11px;
      color: #fff;
      background: #111;
      padding: 8px 12px;
      border: 1px dashed #555;
      cursor: copy;
      word-break: break-all;
      max-width: 280px;
    }

    .copy-hint {
      font-size: 9px;
      color: #999;
      margin-top: 2px;
    }

    pre {
      background: #050505;
      color: #0f0;
      padding: 10px;
      font-size: 10px;
      margin-top: 20px;
      white-space: pre-wrap;
      border: 1px solid #111;
    }
  </style>
</head>
<body>

<div class="header-container">
  <a id="helpLink" href="index.html"><img src="logo.png" alt="Logo" class="logo-image"></a>
    <div>
    <h2 style="margin-bottom: 0;">Vital Spark</h2>
    <p style="margin-top: 4px;">Your mind stop loss</p>
  </div>

</div>

<details class="protocol-details">
  <summary>Help mindset [?]</summary>
  <div class="protocol-content">
<p>
You are important to other people, they listen to you. Decision-making is psychology. Clarity of mind is the only foundation for success. Without emotional stability, every action becomes a gamble. Monitor your internal state; it is your primary safety limit. Master the game through composure. Follow the protocol.
</p>
<p>
<strong>Commit to Action: </strong> 
Only when your internal metrics form a synchronized plateau of stability. Be honest with yourself — this clarity is your only true advantage.
</p>
<p>
<strong>Refrain from Action: </strong> 
Avoid action if the readings are scattered across the entire scale. 
</p>

<strong> The Risk Readiness Index (Rq) indicator </strong> 
is your digital failsafe. It analyzes the gap between your biological state and market chaos: the higher the value, the higher the probability of success.
</p>


</div>
</details>

<div class="select-container">

  <div class="select-group"><label for="time" style="color: var(--time-color);">Timeframe</label>
    <select id="time" onchange="log('time')"><option selected disabled>—</option><option value="1">Minute</option><option value="2">Hour</option><option value="3">Day</option><option value="4">Week</option><option value="5">Month</option></select>
  </div>
  <div class="select-group"><label for="breath" style="color: var(--breath-color);">Breathing</label>
    <select id="breath" onchange="log('breath')"><option selected disabled>—</option><option value="1">Mouth in/out</option><option value="2">Mouth in, nose out</option><option value="3">Sensing...</option><option value="4">Nose in/out</option><option value="5">Nose in, mouth out</option></select>
  </div>
  <div class="select-group"><label for="pulse" style="color: var(--pulse-color);">Pulse</label>
    <select id="pulse" onchange="log('pulse')"><option selected disabled>—</option><option value="1">< 60</option><option value="2">60-80</option><option value="3">80-100</option><option value="4">100-120</option><option value="5">> 120</option></select>
  </div>
  <div class="select-group"><label for="emotion" style="color: var(--emotion-color);">Emotions</label>
    <select id="emotion" onchange="log('emotion')"><option selected disabled>—</option><option value="1">Anxiety</option><option value="2">Harmony</option><option value="3">Calmness</option><option value="4">Joy</option><option value="5">Serenity</option></select>
  </div>
  <div class="select-group"><label for="dopamine" style="color: var(--dopamine-color);">Anticipation</label>
    <select id="dopamine" onchange="log('dopamine')"><option selected disabled>—</option><option value="1">Greed</option><option value="2">Excited</option><option value="3">Neutral</option><option value="4">Patient</option><option value="5">Stoic</option></select>
  </div>
  <div class="select-group"><label for="load" style="color: var(--load-color);">Cognitive Load</label>
    <select id="load" onchange="log('load')"><option selected disabled>—</option><option value="1">Overloaded</option><option value="2">Tired</option><option value="3">Stable</option><option value="4">Fresh</option><option value="5">Hyper-aware</option></select>
  </div>
  <div class="select-group"><label for="tension" style="color: var(--tension-color);">Body Tension</label>
    <select id="tension" onchange="log('tension')"><option selected disabled>—</option><option value="1">Rigid</option><option value="2">Tense</option><option value="3">Noticeable</option><option value="4">Relaxed</option><option value="5">Fluid</option></select>
  </div>
  <div class="select-group"><label for="energy" style="color: var(--energy-color);">Energy</label>
    <select id="energy" onchange="log('energy')"><option selected disabled>—</option><option value="1">Exhausted</option><option value="2">Low</option><option value="3">Medium</option><option value="4">High</option><option value="5">Peak</option></select>
  </div>
  <div class="select-group"><label for="focus" style="color: var(--focus-color);">Focus</label>
    <select id="focus" onchange="log('focus')"><option selected disabled>—</option><option value="1">Distracted</option><option value="2">Intermittent</option><option value="3">Stable</option><option value="4">Strong</option><option value="5">Full</option></select>
  </div>
  <div class="select-group"><label for="creativity" style="color: var(--creativity-color);">Creativity</label>
    <select id="creativity" onchange="log('creativity')"><option selected disabled>—</option><option value="1">Block</option><option value="2">Rare</option><option value="3">Productive</option><option value="4">Active</option><option value="5">Flow</option></select>
  </div>
  <div class="select-group"><label for="vision" style="color: var(--vision-color);">Vision</label>
    <select id="vision" onchange="log('vision')"><option selected disabled>—</option><option value="1">Blurred</option><option value="2">Dim</option><option value="3">Normal</option><option value="4">Clear</option><option value="5">Vivid</option></select>
  </div>
  <div class="select-group"><label for="hearing" style="color: var(--hearing-color);">Hearing</label>
    <select id="hearing" onchange="log('hearing')"><option selected disabled>—</option><option value="1">Muffled</option><option value="2">Weak</option><option value="3">Normal</option><option value="4">Detailed</option><option value="5">Acute</option></select>
  </div>
  <div class="select-group"><label for="smell" style="color: var(--smell-color);">Smell</label>
    <select id="smell" onchange="log('smell')"><option selected disabled>—</option><option value="1">None</option><option value="2">Faint</option><option value="3">Normal</option><option value="4">Sharp</option><option value="5">Sensitive</option></select>
 </div>
   <div class="select-group"><label for="vesting" style="color: var(--vesting-color);">Vesting Risk</label>
    <select id="vesting" onchange="log('vesting')"><option selected disabled>—</option><option value="1">Massive Unlock Soon</option><option value="2">Ongoing Dilution</option><option value="3">Stable</option><option value="4">Locked</option><option value="5">Deflationary</option></select>
  </div>
  <div class="select-group"><label for="hype" style="color: var(--hype-color);">Hype Audit</label>
    <select id="hype" onchange="log('hype')"><option selected disabled>—</option><option value="1">Peak Mania</option><option value="2">Influencer Shilling</option><option value="3">Organic Interest</option><option value="4">Quiet Accumulation</option><option value="5">Dead Silence</option></select>
  </div>
  <div class="select-group"><label for="squeeze" style="color: var(--squeeze-color);">Squeeze Check</label>
    <select id="squeeze" onchange="log('squeeze')"><option selected disabled>—</option><option value="1">Blow-off Top</option><option value="2">Overextended</option><option value="3">Consolidation</option><option value="4">Base Building</option><option value="5">Undervalued</option></select>
  </div>
  <div class="select-group"><label for="supply" style="color: var(--supply-color);">Supply Risk</label>
    <select id="supply" onchange="log('supply')"><option selected disabled>—</option><option value="1">Infinite Mint</option><option value="2">Low Float / High FDV</option><option value="3">Fair Launch</option><option value="4">Capped Supply</option><option value="5">Burn Mechanism</option></select>
  </div>
  <div class="select-group"><label for="audit" style="color: var(--audit-color);">Info Audit</label>
    <select id="audit" onchange="log('audit')"><option selected disabled>—</option><option value="1">Total Scampump</option><option value="2">Vague Promises</option><option value="3">Solid Roadmap</option><option value="4">Proven Team</option><option value="5">Tier-1 Fundamental</option></select>
  </div>
</div>

<div class="chart-container">
  <canvas id="chart"></canvas>
</div>

  <div id="risk-container" style="margin-top: 20px; border: 1px solid #333; padding: 15px;">
  <div style="display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 5px;">
    <span>Risk Readiness (Rq)</span>
    <span id="risk-value">0.00</span>
  </div>
  <div style="width: 100%; background: #111; height: 8px; border-radius: 4px; overflow: hidden;">
    <div id="risk-bar" style="width: 0%; height: 100%; background: var(--emotion-color); transition: all 0.5s;"></div>
  </div>

<div style="display: flex; justify-content: space-between; font-size: 9px; color: #bef0ff	; margin-top: 4px; text-transform: uppercase; letter-spacing: 1px;">
  <span>⬅️ Unreal</span>
  <span>Real ➡️</span>
</div>

  <p id="risk-advice" style="font-size: 10px; color: #666; margin-top: 8px; font-style: italic;">Fill metrics to calculate...</p>
</div>

<div class="buttons">
  <button class="ui-btn" onclick="toggleData()">JSON Archive</button>
  <button class="ui-btn" onclick="if(confirm('Clear data?')) { localStorage.clear(); location.reload(); }">Reset</button>
</div>

<pre id="savedDataView" style="display:none"></pre>

<footer>
  <div class="footer-left">
    <div class="donate-box">
      <button class="donate-btn" onclick="toggleDonate()">Donate</button>
      <div id="cryptoInfo" class="crypto-info">
        <span class="network-label">Network: Tron</span>
        <div id="cryptoAddr" class="crypto-address-display" onclick="copyToClipboard()">TBL5FqL1zSGdP9k6nGkakxmPM26ttcJ496</div>
        <span class="copy-hint">Click on the address to copy</span>
      </div>
    </div>
  </div>
</footer>

<script>
  const rows = ['time', 'breath', 'pulse', 'emotion', 'dopamine', 'load', 'tension', 'energy', 'focus', 'creativity', 'vision', 'hearing', 'smell', 'vesting', 'hype', 'squeeze', 'supply', 'audit'];
  const colors = {
    time: '#8493d6',  breath: '#ffffff', pulse: '#ff1493', emotion: '#ff5252', dopamine: '#ff00ff',
    load: '#adff2f', tension: '#cccccc', energy: '#ff9800', focus: '#ffeb3b',
    creativity: '#00ff00', vision: '#0000ff', hearing: '#9c27b0', smell: '#00bcd4', vesting: '#ff0000', hype: '#00ffff', squeeze: '#ffff00', supply: '#ffa500', audit: '#7cfc00'
  };
  const categoryNames = {
    time: 'Timeframe',  breath: 'Breath', pulse: 'Pulse', emotion: 'Emotions', dopamine: 'Anticipation',
    load: 'Load', tension: 'Tension', energy: 'Energy', focus: 'Focus',
    creativity: 'Creativity', vision: 'Vision', hearing: 'Hearing', smell: 'Smell', vesting: 'Vesting Risk', hype: 'Hype Audit', squeeze: 'Squeeze Check', supply: 'Supply Risk', audit: 'Info Audit'
  };

  const STORAGE_KEY = "core_metrics_trading_v2";
  const ctx = document.getElementById('chart').getContext('2d');

  const chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: [],
      datasets: rows.map(key => ({
        label: categoryNames[key],
        data: [],
        borderColor: colors[key],
        borderWidth: 2,
        pointRadius: 2,
        fill: false,
        tension: 0.3
      }))
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { display: false } },
      scales: {
        y: { min: 0.8, max: 5.2, display: false, grid: { display: false } },
        x: { display: false, grid: { display: false } }
      }
    }
  });

  // Основная функция логирования
  function log(key) {
    const val = +document.getElementById(key).value;
    let col = chart.data.labels.length;
    
    // Проверяем, нужно ли создать новую колонку данных
    const isColumnFull = col > 0 && chart.data.datasets.every(ds => ds.data[col - 1] != null);
    
    if (isColumnFull || col === 0) {
      chart.data.labels.push(++col);
    }
    
    chart.data.datasets[rows.indexOf(key)].data[col - 1] = val;
    chart.update();
    saveToStorage();
    updateRiskIndicator(); // Обновляем шкалу сразу после ввода
  }

  function calculateRiskQuine() {
    const data = chart.data.datasets;
    const lastIdx = chart.data.labels.length - 1;
    if (lastIdx < 0) return 0;

    const internalKeys = [1, 2, 3, 5, 6, 7, 8, 9, 10, 11, 12];
    const internalValues = internalKeys.map(i => data[i].data[lastIdx]).filter(v => v != null);

    const externalKeys = [13, 14, 15, 16, 17];
    const externalValues = externalKeys.map(i => data[i].data[lastIdx]).filter(v => v != null);

    if (internalValues.length === 0) return 0;

    const avgInternal = internalValues.reduce((a, b) => a + b, 0) / internalValues.length;
    const avgExternal = externalValues.length > 0 
        ? externalValues.reduce((a, b) => a + b, 0) / externalValues.length 
        : 3;

    return Math.min((avgInternal * Math.log1p(avgExternal)) / 10, 1).toFixed(2);
  }

  function updateRiskIndicator() {
    const score = calculateRiskQuine();
    const bar = document.getElementById('risk-bar');
    const valText = document.getElementById('risk-value');
    const advice = document.getElementById('risk-advice');
    
    if (!bar || !valText) return;

    const percentage = score * 100;
    bar.style.width = percentage + '%';
    valText.innerText = score;

    if (score < 0.45) {
      bar.style.background = '#ff1493';
      advice.innerText = "Keep your distance. Call Vital Spark if you're tempted to click 'Buy'.";
    } else if (score < 0.75) {
      bar.style.background = '#ff9800';
      advice.innerText = "Stability is mediocre. Reduce position size, avoid leverage.";
    } else {
      bar.style.background = '#00ff00';
      advice.innerText = "Synchronized plateau achieved. Proceed with clinical precision.";
    }
  }

  function saveToStorage() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify({
      labels: chart.data.labels,
      data: chart.data.datasets.map(ds => ds.data)
    }));
  }

  function loadFromStorage() {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (!saved) return;
    try {
      const { labels, data } = JSON.parse(saved);
      chart.data.labels = labels;
      data.forEach((d, i) => { if(chart.data.datasets[i]) chart.data.datasets[i].data = d; });
      chart.update();
      updateRiskIndicator();
    } catch(e) { console.error("Data corruption", e); }
  }

  function toggleData() {
    const pre = document.getElementById("savedDataView");
    pre.style.display = pre.style.display === "none" ? "block" : "none";
    if (pre.style.display === "block") {
      const data = localStorage.getItem(STORAGE_KEY);
      pre.textContent = data ? JSON.stringify(JSON.parse(data), null, 2) : "No data";
    }
  }

  function toggleDonate() {
    const info = document.getElementById("cryptoInfo");
    info.style.display = (info.style.display === "flex") ? "none" : "flex";
  }

  function copyToClipboard() {
    const addr = document.getElementById("cryptoAddr");
    const text = addr.innerText;
    navigator.clipboard.writeText(text).then(() => {
      addr.innerText = "Address Copied!";
      addr.style.color = "#00ff00";
      setTimeout(() => {
        addr.innerText = text;
        addr.style.color = "#fff";
      }, 1500);
    });
  }

  window.addEventListener("DOMContentLoaded", loadFromStorage);
</script>


</body>
</html>
