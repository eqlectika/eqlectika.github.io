<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="manifest" href="manifest.json">
    <style>
        :root { --t: 0.4s; --btn: 56px; }
        * { -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; -webkit-tap-highlight-color: transparent; box-sizing: border-box; border-radius: 0 !important; }
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background: #000; font-family: "Times New Roman", serif; font-size: 16px; }
        
        #gateway { display: grid; grid-template-columns: 1fr 1fr; height: 100%; width: 100%; position: absolute; z-index: 1000; transition: transform var(--t) ease; background: #000; }
        .input-pane { border: none; padding: 10px; font-size: 1.1rem; font-family: serif; resize: none; height: 100%; width: 100%; outline: none; }
        .light { background: #fff; color: #000; }
        .dark { background: #000; color: #fff; }

        .master-btn { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: var(--btn); height: var(--btn); border-radius: 50% !important; border: 1px solid #666; background: #111; color: #fff; cursor: pointer; z-index: 2000; display: flex; align-items: center; justify-content: center; font-size: 9px; letter-spacing: 1px; }

        .app-container { display: grid; height: 100vh; grid-template-columns: 1fr 0fr 1fr; transition: grid-template-columns var(--t) ease; }
        .pane { overflow-y: auto; padding: 10px; line-height: 1.4; border: none; }
        .central-col { display: grid; grid-template-rows: 1fr 1fr; overflow: hidden; background: transparent; }
        
/* СТАЛО: */
.central-col.final { 
    grid-template-rows: 1fr 1fr 1fr; 
}
.final-row { 
    display: none; 
    grid-template-columns: 1fr 1fr; 
    height: auto; 
}
        .central-col.final .final-row { display: grid; }

        .word { cursor: pointer; padding: 0 1px; }
        .light .word.active { background: #000; color: #fff; }
        .dark .word.active { background: #fff; color: #000; }
        
        .footer-logo { position: absolute; bottom: 15px; left: 50%; transform: translateX(-50%); z-index: 3000; }
        .footer-logo img { height: 48px; width: auto; display: block; opacity: 1; filter: grayscale(100%); }
        .hidden { display: none; }
        .example { display: block; margin-top: 8px; font-style: italic; opacity: 0.9; }
   

/* В блоке #outD добавляем центрирование */
#outL, #outD {
    display: flex;
    flex-direction: column;
    height: 100%;
    text-align: center; /* Центрируем текст внутри всей колонки */
}

.outD-content, .outL-content {
    flex: 1;
    overflow-y: auto;
    width: 100%; /* Занимаем всю ширину */
    padding: 10px; /* Возвращаем внутренний отступ для текста */
}

/* Центрируем кнопку и адрес */
.donate-box { 
    padding: 20px 15px; 
    flex-shrink: 0; 
    border-top: 1px solid rgba(255,255,255,0.1) !important;
    margin-top: auto; /* Прижимаем к низу */
    display: flex;
    flex-direction: column;
    align-items: center; /* Центрируем кнопку по горизонтали */
}


.donate-btn { 
    color: rgba(255,255,255,0.7); 
    border: 1px solid rgba(255,255,255,0.7) !important; 
    padding: 8px 20px; 
    background: transparent; 
    cursor: pointer; 
    font-size: 11px; 
    letter-spacing: 1px;
    transition: 0.3s;
}

.donate-btn:hover { background: #fff; color: #000; }

.crypto-info { 
    display: none; 
    flex-direction: column; 
    gap: 8px; 
    margin-top: 15px;
}

.crypto-address-display { 
    font-size: 10px; 
    color: #fff; 
    background: rgba(255,255,255,0.05); 
    padding: 10px; 
    border: 1px dashed #fff !important; 
    cursor: copy; 
    word-break: break-all; 
}

 </style>
</head>
<body>
    <script src="pwa-init.js"></script>
    
<div id="gateway">
    <textarea id="inL" class="input-pane light">Привет! На самом деле, учить английский довольно просто. Однако это требует времени. Этот инструмент немного помогает нам.</textarea>
    <div style="position: absolute; left: 50%; height: 100%; width: 0; background: transparent;"><div class="master-btn" onclick="launchApp()">SYNC</div></div>
    <textarea id="inD" class="input-pane dark">Hello! Actually, learning English is quite simple. However, it takes time. This code helps us a bit.</textarea>
</div>

<div class="master-btn hidden" id="uiBtn" onclick="handleUIBtn()">GATE</div>

<div class="app-container" id="main">

<div class="pane light" id="outL">
    <div class="outL-content" id="outL-inner"></div>
</div>

    <div class="central-col" id="center">
        <div class="pane light" id="s2-top"></div>
        <div class="final-row" id="s3-row"><div class="pane light" id="s3-L"></div><div class="pane dark" id="s3-D"></div></div>
        <div class="pane dark" id="s2-bot"></div>
    </div>

<div class="pane dark" id="outD">
    <div class="outD-content" id="outD-inner"></div>
    
    <div class="donate-box">
        <button class="donate-btn" onclick="toggleDonate()">Support</button>
        <div id="cryptoInfo" class="crypto-info">
            <span style="font-size: 11px; color: #fff;">USDT BSC (BEP20)</span>
            <div id="cryptoAddr" class="crypto-address-display" onclick="copyToClipboard()">0x769192cea8fbb7207f086d95fd653ebc3adb0c72</div>
            <span id="copyHint" style="font-size: 10px; color: #fff;">Click to copy address</span>
        </div>
    </div>
</div>


<a href="/index.html" class="footer-logo"><img src="logo.png" alt="logo"></a>

<script>
let state = 0;

const db = {
    "привет": { 
        l1: ["Приветствие (межд.).", "Пример: Привет, друг!", "Greeting (intj.).", "Example: Hello, friend!"], 
        l2: ["От др.-русск. привѣтъ (совет).", "Пример: Добрый привет.", "From Old Slavic 'privet'.", "Example: Kind greeting."],
        pair: "hello" 
    },
    "hello": { 
        l1: ["Greeting (intj.).", "Example: Hello, friend!", "Приветствие (межд.).", "Пример: Привет, друг!"], 
        l2: ["From Old German 'hallo'.", "Example: Say hello.", "От др.-герм. hallo.", "Пример: Скажи привет."],
        pair: "привет" 
    },
    "мир": { 
        l1: ["Вселенная (сущ.).", "Пример: Наш мир велик.", "Universe (noun).", "Example: Our world is big."], 
        l2: ["От праслав. mirъ (покой).", "Пример: Жить в мире.", "From Proto-Slavic mir (peace).", "Example: Live in peace."],
        pair: "world" 
    },
    "world": { 
        l1: ["Universe (noun).", "Example: Our world is big.", "Вселенная (сущ.).", "Пример: Наш мир велик."], 
        l2: ["From Old English 'weorold'.", "Example: Whole world.", "От др.-англ. weorold.", "Пример: Весь мир."],
        pair: "мир" 
    }
};

function tokenize(t) {
    if (!t) return "";
    if (Array.isArray(t)) {
        return `<div>${tokenize(t[0])}</div><div class="example">${tokenize(t[1])}</div>`;
    }
    return t.split(/(\s+|[,!?.])/).map(p => {
        if (/[\s+,!?. ]/.test(p) || p === "") return p;
        return `<span class="word" data-raw="${p.toLowerCase().replace(/[.,!?]/g, '')}">${p}</span>`;
    }).join('');
}

function launchApp() {

document.getElementById('outL-inner').innerHTML = tokenize(document.getElementById('inL').value);
    document.getElementById('outD-inner').innerHTML = tokenize(document.getElementById('inD').value);
    document.getElementById('gateway').style.transform = 'translateY(-100%)';
    document.getElementById('uiBtn').classList.remove('hidden');
    state = 1;
}

document.addEventListener('click', (e) => {
    const w = e.target.closest('.word');
    if (!w || state === 0) return;

    const raw = w.dataset.raw;
    const pane = w.closest('.pane');
    if (!pane) return;
// Динамическая смена языка документа
if (pane.classList.contains('light')) {
    document.documentElement.lang = 'ru';
} else if (pane.classList.contains('dark')) {
    document.documentElement.lang = 'en';
}

    // Сброс и инверсия
    document.querySelectorAll('.word').forEach(el => el.classList.remove('active'));
    
    // Сквозной поиск по всему документу (для гарантии отзыва)
    document.querySelectorAll(`.word[data-raw="${raw}"]`).forEach(el => el.classList.add('active'));
    
    // Поиск партнера только для Уровня 0
    if (pane.id === 'outL' || pane.id === 'outD') {
        const partnerRaw = db[raw]?.pair;
        if (partnerRaw) document.querySelectorAll(`.word[data-raw="${partnerRaw}"]`).forEach(el => el.classList.add('active'));

        document.getElementById('main').style.gridTemplateColumns = '1fr 1.5fr 1fr';
        const entry = db[raw] || { l1: [`Толкование: ${raw}`, `Пример: ...`, `Definition: ${raw}`, `Example: ...`] };
        document.getElementById('s2-top').innerHTML = tokenize([entry.l1[0], entry.l1[1]]);
        document.getElementById('s2-bot').innerHTML = tokenize([entry.l1[2], entry.l1[3]]);
        
        document.getElementById('center').classList.remove('final');
        document.getElementById('uiBtn').innerText = "CLOSE";
        state = 2;
    } 
    else if (pane.id === 's2-top' || pane.id === 's2-bot') {
        const entry = db[raw] || { l2: [`Этимология`, `Пример: ...`, `Etymology`, `Example: ...`] };
        document.getElementById('center').classList.add('final');
        document.getElementById('s3-L').innerHTML = tokenize([entry.l2 ? entry.l2[0] : "Этимология"]);
        document.getElementById('s3-D').innerHTML = tokenize([entry.l2 ? entry.l2[2] : "Etymology"]);
        document.getElementById('uiBtn').innerText = "RESET";
        state = 3;
    }
});

function handleUIBtn() {
    if (state >= 2) {
        document.getElementById('main').style.gridTemplateColumns = '1fr 0fr 1fr';
        document.getElementById('center').classList.remove('final');
        document.querySelectorAll('.word').forEach(el => el.classList.remove('active'));
        document.getElementById('uiBtn').innerText = "GATE";
        state = 1;
    } else if (state === 1) {
        document.getElementById('gateway').style.transform = 'translateY(0)';
        document.getElementById('uiBtn').classList.add('hidden');
        state = 0;
    }
}

function toggleDonate() { 
    const info = document.getElementById("cryptoInfo"); 
    const isOpening = (info.style.display !== "flex");
    info.style.display = isOpening ? "flex" : "none"; 
    
    if (isOpening) {
        setTimeout(() => {
            info.scrollIntoView({ behavior: 'smooth', block: 'end' });
        }, 50);
    }
}

function copyToClipboard() {
    const addr = document.getElementById("cryptoAddr");
    const text = addr.innerText;
    navigator.clipboard.writeText(text).then(() => {
        const oldText = addr.innerText;
        addr.innerText = "Copied!";
        addr.style.color = "#00ff00";
        setTimeout(() => {
            addr.innerText = oldText;
            addr.style.color = "#fff";
        }, 1500);
    });
}

</script>
</body>
</html>
